---
 - hosts: server
   become: yes
   tasks:

           - name: install curl
             become_method: sudo
             command: apt-get install -y curl

           - name: install node 
             shell: |
                 curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash - && sudo apt-get install -y nodejs    

           - name: install fe rquired appilactin
             become: true
             become_user: root
             apt: name={{ item }} state=present update_cache=yes
             with_items:
                   - build-essential
                   -  curl 
                   - nodejs
                   - libfontconfig
                   - git-core
                   - tar
                   - python
                   - nginx
                     # - grunt

           - name: install stubby
             npm:
                     name: stubby
                     global: yes
                     version: '0.2.13'
                  
           - name: install grunt
             npm:
                   name: grunt-cli 
                   global: yes
                   version: '0.1.13'       

           - name: install stubby
             npm:
                  name: graceful-fs
                  global: yes
                  version: '4.1.4'

           - name: install bower
             npm:
                     name: bower
                     global: yes

           - name: installl phantomjs-prebuilt
             become_method: sudo
             command: sudo npm install -g phantomjs-prebuilt@2.1.3 --ignore-scripts

             #- name: get a ta file in nodejs 
             #get_url: url=http://nodejs.org/dist/v10.6.0/node-v10.6.0.tar.gz dest=/usr/local/src/
             
           - name: unarchive the file
             become: yes
             become_user: root
             unarchive:
                     src: http://nodejs.org/dist/v10.6.0/node-v10.6.0.tar.gz 
                     dest: /usr/local/src/
                     remote_src: yes

           - name: change the ownership on node directory
             become: yes
             file:
                     path: /usr/local/src/node-v10.6.0
                     recurse: yes
                     owner: ubuntu
                     group: ubuntu

           - name: go to node directory and ececute make install
             become: yes
             become_user: root
             args:
                    chdir: /usr/local/src/node-v10.6.0
             command: ./configure

           - name: go to node directory and ececute make install
             become: yes
             become_user: root
             become_method: sudo
             args:
                    chdir: /usr/local/src/node-v10.6.0
             command: make
             command: make install
           
           - name: move the new file to old file
             become: yes
             become_user: root
             args:
                      chdir: /usr/local/bin/
             command: mv /usr/local/bin/node /usr/local/bin/node10         

           - name: link the node file
             become: yes
             become_user: root
             file:
                     src: /usr/local/bin/node10 
                     dest: /usr/local/bin/node 
                     state: link 
          
           - name: configure the nginx config file
             become: yes
             become_user: root           
             template: src=/home/karan/gooru-fe/nginx.conf  dest=/etc/nginx/nginx.conf
                          
           - name: increase npm heap size
             become_method: sudo 
             command: mkdir -p /opt/build/

           - name: clone the gooru fe repo
             become: yes
             become_user: root
             args:
                     chdir: /opt/build/
             command: git clone https://gooru-karthick:Karthick%40G0oru@github.com/Gooru/quizzes.git
             ignore_errors: yes

           - name: chane ownership on cloned file
             file:
                     path: /opt/build/quizzes/
                     recurse: yes
                     owner: ubuntu
                     group: ubuntu

           - name: install the quizzed add on package
             become: yes
             become_user: root
             args:
                     chdir: /opt/build/quizzes/
             command: npm install
             command: bower install --allow-root
             command: sudo npm link  

           - name: clone gooru-FE repo
             become: yes
             become_user: root
             args:
                     chdir: /opt/build/
             command: git clone https://gooru-karthick:Karthick%40G0oru@github.com/Gooru/Gooru-FE.git
             ignore_errors: yes

           - name: update the packges.json file
             become: yes
             become_user: root
             template: src=/home/karan/gooru-fe/package.json dest=/opt/build/Gooru-FE/package.json

           - name: chenge the ownership to Gooru fe
             become: yes
             become_user: root
             file:
                     path: /opt/build/Gooru-FE
                     owner: ubuntu
                     group: ubuntu

           - name: install grunt
             become: yes
             become_user: root
             become_method: sudo
             args:
                     chdir: /opt/build/Gooru-FE/
             command: sudo npm install grunt        

           - name: FE build installtion app
             become: yes
             become_user: root
             become_method: sudo
             args:
                     chdir: /opt/build/Gooru-FE/ 
                     #command: npm install grunt
             command: yarn install       
             command: bower install --allow-root
             command: grunt eslint
             command: grunt test --force

           - name: copy the gooru web folder to /var/www location
             become: yes
             become_user: root
             copy:
                     src: /opt/build/Gooru-FE/gooru-web
                     dest: /var/www/
                     recurse: yes

           - name: replace json file
             become: yes
             become_user: root
             template: src=/home/karan/gooru-fe/nile.usalearning.net.json  dest=/var/www/gooru-web/config/nile.usalearning.net.json



            



           
           

